<RendererConfig renderWidth="1920" renderHeight="1080">
    <Images>
        <GBufferColor format="RGBA8UNorm" resolution="Full" sampled="" />
        <GBufferNormals format="RGBA16SNorm" resolution="Full" sampled="" />
        <GBufferParameters format="RGBA8UNorm" resolution="Full" sampled="" />
        <SceneHDR format="R11G11B10UFloat" resolution="Full" sampled="" storage="" />
        <SceneSDR format="R11G11B10UFloat" resolution="Full" sampled="" storage="" />
        <DepthBuffer format="Depth32SFloat" resolution="Full" sampled="" />
        <CascadeShadows format="Depth16" width="2048" height="2048" sampled="" array_size="3" />
    </Images>
    <RenderTasks>

        <ComputeAvgLuminance 
            name="ComputeAvgLuminance" 
            buildShader="luminance_histogram_build.comp"
            reduceShader="luminance_histogram_reduce.comp"
            histogramBuffer="LuminanceHistogram"
            exposureBuffer="ExposureBuffer">
            <BuildHistogramBindings>
                <InputBuffer usage="Uniform" />
                <InputBuffer usage="Uniform" />
                <InputImage name="SceneHDR" />
                <InputBuffer usage="Storage" name="ExposureBuffer" />
                <OutputBuffer name="LuminanceHistogram" />
            </BuildHistogramBindings>
            <ReduceHistogramBindings>
                <InputBuffer usage="Uniform" />
                <InputBuffer usage="Storage" name="LuminanceHistogram" />
                <OutputBuffer name="ExposureBuffer" />
            </ReduceHistogramBindings>
        </ComputeAvgLuminance>

        <Mesh name="GBufferOpaque" renderPass="GBuffer" materialPassType="GBuffer">
            <OutputImage name="GBufferColor" clear="0, 0, 0, 0" />
            <OutputImage name="GBufferNormals" clear="0, 0, 0, 0" />
            <OutputImage name="GBufferParameters" clear="0, 0, 0, 0" />
            <OutputImage name="DepthBuffer" clear="0" />
            <MaterialPass name="OpaquePBR" />
        </Mesh>

        <BuildHiZ
            name="BuildHiZ"
            shader="build_hiz.comp"
            depthBuffer="DepthBuffer"
            hiZBuffer="HiZBuffer"
            counterBuffer="SPDCounter"
            resolution="Half"
            minMaxDepthBuffer="SceneDepthMinMax"
            resetBufferShaderName="reset_min_max_depth_buffer.comp">

            <ResetMinMaxBindings>
                <OutputBuffer name="SceneDepthMinMax" />
            </ResetMinMaxBindings>

            <BuildHiZBindings>
                <InputBuffer usage="Uniform" />
                <InputBuffer usage="Uniform" />
                <InputImage name="DepthBuffer" />
                <OutputBuffer name="SPDCounter" />
                <OutputBuffer name="SceneDepthMinMax" />
                <OutputImage name="HiZBuffer" />
            </BuildHiZBindings>
        </BuildHiZ>

        <PrepareShadowCascades name="PrepareShadowCascades" shader="prepare_shadow_cascades.comp" shadowMapSize="2048" shadowCascadesBuffer="ShadowCascades">
            <InputBuffer usage="Uniform" />
            <InputBuffer usage="Storage" name="SceneDepthMinMax" />
            <OutputBuffer name="ShadowCascades" />
        </PrepareShadowCascades>

        <CascadeShadows name="CascadeShadows" renderPass="CascadeShadows" materialPassType="CascadeShadows" numCascades="3">
            <InputBuffer usage="Uniform"/>
            <InputBuffer usage="Storage" name="ShadowCascades"/>
            <OutputImage name="CascadeShadows" clear="0" />
            <MaterialPass name="OpaquePBR" />
        </CascadeShadows>

        <FullScreen name="Lighting" shader="lighting.comp" resolution="Full">
            <InputBuffer usage="Uniform"/>
            <InputBuffer usage="Storage" name="ExposureBuffer" />
            <InputImage name="GBufferColor" />
            <InputImage name="GBufferNormals" />
            <InputImage name="GBufferParameters" />
            <InputImage name="DepthBuffer" />
            <InputImage name="CascadeShadows" />
            <InputBuffer usage="Storage" name="ShadowCascades" />
            <OutputImage name="SceneHDR" />
        </FullScreen>

        <FullScreen name="Tonemap" shader="tonemap.comp" resolution="Full">
            <InputBuffer usage="Uniform"/>
            <InputImage name="SceneHDR" />
            <OutputImage name="SceneSDR" />
        </FullScreen>

        <FullScreen name="BlitSwapchain" shader="blit_to_swapchain.pix" resolution="Display">
            <InputImage name="SceneSDR" />
            <OutputImage name="SwapImage" />
        </FullScreen>

    </RenderTasks>
</RendererConfig>